<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Share</title>
</head>
<body>
    <h2>Your Video</h2>
    <video id="localVideo" autoplay playsinline></video>
    
    <h2>Remote Video</h2>
    <video id="remoteVideo" autoplay playsinline></video>
    
    <button onclick="startStream()">Start Sharing</button>

    <script>
        const localVideo = document.getElementById("localVideo");
        const remoteVideo = document.getElementById("remoteVideo");

        async function startStream() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            localVideo.srcObject = stream;

            const mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = async (event) => {
                if (event.data.size > 0) {
                    const formData = new FormData();
                    formData.append("video", event.data);

                    await fetch("https://vshare-rr5y.onrender.com/vshare1", {
                        method: "POST",
                        body: formData
                    });
                }
            };

            mediaRecorder.start(100);
        }

        async function fetchVideo() {
            const response = await fetch("https://vshare-rr5y.onrender.com/vshare2");
            const blob = await response.blob();
            remoteVideo.src = URL.createObjectURL(blob);
            fetchVideo();  // Keep polling
        }

        fetchVideo();  // Start polling
    </script>
</body>
</html>
